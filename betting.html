<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline Arbitrage Bet Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen flex flex-col items-center p-6">

<!-- Home Page -->
<div id="home" class="w-full max-w-xl">
  <h1 class="text-4xl font-extrabold text-center mb-8 text-gray-800">Bet Tracker Pro</h1>
  <div class="flex flex-col gap-4">
    <button onclick="showPage('newMatch')" class="p-4 rounded-2xl bg-blue-600 hover:bg-blue-700 transition text-white font-semibold shadow-lg">‚ûï Create New Match</button>
    <button onclick="showHistory()" class="p-4 rounded-2xl bg-green-600 hover:bg-green-700 transition text-white font-semibold shadow-lg">üìÇ Load History</button>
    <button onclick="showReports()" class="p-4 rounded-2xl bg-purple-600 hover:bg-purple-700 transition text-white font-semibold shadow-lg">üìä Reports</button>
  </div>
</div>

<!-- Reports Page -->
<div id="reports" class="hidden w-full max-w-xl">
  <div class="flex justify-between mb-4">
    <button onclick="showPage('home')" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400">üè† Home</button>
    <button onclick="showHistory()" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400">‚¨Ö Back</button>
  </div>
  <h2 class="text-2xl font-bold mb-4">Profit/Loss Reports</h2>
  <div class="mb-4">
    <label class="mr-2 font-semibold">Filter by Winner:</label>
    <select id="reportFilter" onchange="showReports()" class="p-2 rounded-xl">
      <option value="">All</option>
    </select>
  </div>
  <div id="reportContent" class="bg-white p-4 rounded-2xl shadow"></div>
</div>

<!-- New Match Page -->
<div id="newMatch" class="hidden w-full max-w-xl">
  <div class="flex justify-between mb-4">
    <button onclick="showPage('home')" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400">üè† Home</button>
    <button onclick="showHistory()" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400">‚¨Ö Back</button>
  </div>
  <h2 class="text-2xl font-bold mb-4">Create Match</h2>
  <label class="text-sm text-gray-500">Team 1</label>
  <input id="teamA" placeholder="Team A" class="w-full p-3 rounded-xl mb-3 shadow"/>
  <label class="text-sm text-gray-500">Team 2</label>
  <input id="teamB" placeholder="Team B" class="w-full p-3 rounded-xl mb-3 shadow"/>
  <button onclick="createMatchAndOpen()" class="w-full p-3 rounded-2xl bg-blue-600 hover:bg-blue-700 transition text-white font-semibold shadow-lg">Create Match & Add Bets</button>
</div>

<!-- Match Details Page -->
<div id="matchDetails" class="hidden w-full max-w-xl">
  <div class="flex justify-between mb-4">
    <button onclick="showPage('home')" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400">üè† Home</button>
    <button onclick="showHistory()" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400">‚¨Ö Back</button>
  </div>
  <h2 id="matchTitle" class="text-2xl font-bold mb-4"></h2>
  
  <div class="bg-white p-4 rounded-2xl shadow mb-4">
    <h3 class="font-semibold mb-2">Add Bet Entry</h3>
    <select id="betType" class="w-full p-2 rounded-xl mb-2">
      <option value="">Select Bet Type</option>
      <option value="back">Back</option>
      <option value="lay">Lay</option>
    </select>
    <select id="website" class="w-full p-2 rounded-xl mb-2">
      <option value="">Select Website</option>
      <option value="Luck">Luck</option>
      <option value="JY">JY</option>
    </select>
    <select id="teamSelect" class="w-full p-2 rounded-xl mb-2"></select>
    <input id="odds" type="number" step="0.01" placeholder="Odds" class="w-full p-2 rounded-xl mb-2"/>
    <input id="stake" type="number" step="0.01" placeholder="Stake Amount" class="w-full p-2 rounded-xl mb-2"/>
    <div class="flex gap-2">
      <button onclick="addBet()" class="flex-1 p-3 rounded-2xl bg-purple-600 hover:bg-purple-700 transition text-white font-semibold shadow-lg">Add Bet</button>
      <button onclick="undoBet()" class="p-3 rounded-2xl bg-gray-500 hover:bg-gray-600 text-white">Undo</button>
      <button onclick="redoBet()" class="p-3 rounded-2xl bg-gray-500 hover:bg-gray-600 text-white">Redo</button>
    </div>
  </div>

  <div class="bg-white p-4 rounded-2xl shadow mb-4">
    <h3 class="font-semibold mb-2">Match Result</h3>
    <select id="winnerSelect" onchange="saveWinner()" class="w-full p-2 rounded-xl"></select>
  </div>

  <div id="plSummary" class="bg-white p-4 rounded-2xl shadow mb-4"></div>
  <div id="betList" class="bg-white p-4 rounded-2xl shadow mb-4"></div>
</div>

<!-- History Page -->
<div id="history" class="hidden w-full max-w-xl">
  <div class="flex justify-between mb-4">
    <button onclick="showPage('home')" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400">üè† Home</button>
  </div>
  <h2 class="text-2xl font-bold mb-4">Match History</h2>
  <div id="historyList" class="space-y-3"></div>
</div>

<!-- Script -->
<script>
let currentMatchId = null;
let undoStack = [];
let redoStack = [];

function showPage(page){
  ['home','newMatch','history','matchDetails','reports'].forEach(id => document.getElementById(id).classList.add('hidden'));
  document.getElementById(page).classList.remove('hidden');
}

function createMatchAndOpen(){
  const teamA = document.getElementById('teamA').value;
  const teamB = document.getElementById('teamB').value;
  if(!teamA || !teamB){ alert('‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßã!'); return; }
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  const newMatch = {
    id: Date.now(),
    name: `${teamA} vs ${teamB}`,
    teamA, teamB,
    date: new Date().toLocaleDateString(),
    bets: [],
    winner: ""
  };
  matches.unshift(newMatch);
  localStorage.setItem('matches', JSON.stringify(matches));
  openMatch(newMatch.id);
}

function openMatch(id){
  currentMatchId = id;
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  let match = matches.find(m => m.id === id);
  document.getElementById('matchTitle').innerText = match.name;
  document.getElementById('teamSelect').innerHTML = `<option value="">Select Team</option>
    <option value="${match.teamA}">${match.teamA}</option>
    <option value="${match.teamB}">${match.teamB}</option>`;
  document.getElementById('winnerSelect').innerHTML = `<option value="">Select Winner</option>
    <option value="${match.teamA}">${match.teamA}</option>
    <option value="${match.teamB}">${match.teamB}</option>`;
  document.getElementById('winnerSelect').value = match.winner;
  showPage('matchDetails');
  renderBets();
  calculatePL();
}

function addBet(){
  const type = document.getElementById('betType').value;
  const website = document.getElementById('website').value;
  const team = document.getElementById('teamSelect').value;
  const odds = parseFloat(document.getElementById('odds').value);
  const stake = parseFloat(document.getElementById('stake').value);

  if(!type || !website || !team || !odds || !stake){
    alert('‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßã!');
    return;
  }

  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  let match = matches.find(m => m.id === currentMatchId);
  const bet = {type, website, team, odds, stake};
  match.bets.push(bet);
  localStorage.setItem('matches', JSON.stringify(matches));

  undoStack.push({action: 'add', bet});
  redoStack = [];
  
  renderBets();
  calculatePL();
}

function undoBet(){
  if(undoStack.length === 0) return;
  const last = undoStack.pop();
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  let match = matches.find(m => m.id === currentMatchId);
  if(last.action === 'add'){
    match.bets.pop();
    redoStack.push(last);
  }
  localStorage.setItem('matches', JSON.stringify(matches));
  renderBets();
  calculatePL();
}

function redoBet(){
  if(redoStack.length === 0) return;
  const last = redoStack.pop();
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  let match = matches.find(m => m.id === currentMatchId);
  if(last.action === 'add'){
    match.bets.push(last.bet);
    undoStack.push(last);
  }
  localStorage.setItem('matches', JSON.stringify(matches));
  renderBets();
  calculatePL();
}

function renderBets(){
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  let match = matches.find(m => m.id === currentMatchId);
  const betList = document.getElementById('betList');
  if(match.bets.length === 0){
    betList.innerHTML = '<p>No bets added yet.</p>';
    return;
  }
  betList.innerHTML = match.bets.map((b,i) =>
    `<div class="flex justify-between mb-2 p-2 border rounded-xl">
      <div>
        <p><strong>${b.type.toUpperCase()}</strong> | ${b.team} | ${b.website}</p>
        <p>Odds: ${b.odds}, Stake: ${b.stake}</p>
      </div>
    </div>`
  ).join('');
}

function calculatePL(){
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  let match = matches.find(m => m.id === currentMatchId);
  if(!match) return;

  const plSummary = document.getElementById('plSummary');
  if(match.bets.length === 0){
    plSummary.innerHTML = '<p>No bets yet.</p>';
    return;
  }

  const winner = match.winner;
  let teamPL = {};
  let sitePL = {};

  match.bets.forEach(b => {
    let profit = 0;
    if(winner){
      if(b.type === 'back'){
        profit = b.team === winner ? (b.stake * (b.odds-1)) : -b.stake;
      } else if(b.type === 'lay'){
        profit = b.team === winner ? -((b.odds-1)*b.stake) : b.stake;
      }
    }
    teamPL[b.team] = (teamPL[b.team] || 0) + profit;
    sitePL[b.website] = (sitePL[b.website] || 0) + profit;
  });

  let html = `<h3 class="font-semibold mb-2">Profit/Loss Summary</h3>`;
  html += `<p class="mb-1"><strong>Teams:</strong> ${Object.entries(teamPL).map(([team,pl]) => `${team}: ${pl.toFixed(2)}`).join(' | ')}</p>`;
  html += `<p><strong>Websites:</strong> ${Object.entries(sitePL).map(([site,pl]) => `${site}: ${pl.toFixed(2)}`).join(' | ')}</p>`;
  plSummary.innerHTML = html;
}

function saveWinner(){
  const winner = document.getElementById('winnerSelect').value;
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  let match = matches.find(m => m.id === currentMatchId);
  match.winner = winner;
  localStorage.setItem('matches', JSON.stringify(matches));
  calculatePL();
}

function showHistory(){
  showPage('history');
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  const historyList = document.getElementById('historyList');
  if(matches.length === 0){
    historyList.innerHTML = '<p>No matches yet.</p>';
    return;
  }
  historyList.innerHTML = matches.map(m =>
    `<div class="p-3 border rounded-xl flex justify-between items-center cursor-pointer hover:bg-gray-100" onclick="openMatch(${m.id})">
      <div>
        <p class="font-semibold">${m.name}</p>
        <p class="text-sm text-gray-500">${m.date}</p>
      </div>
      <div>${m.winner ? 'üèÜ '+m.winner : ''}</div>
    </div>`
  ).join('');
}

function showReports(){
  showPage('reports');
  let matches = JSON.parse(localStorage.getItem('matches')) || [];
  const filter = document.getElementById('reportFilter').value;
  const reportContent = document.getElementById('reportContent');

  let filtered = matches;
  if(filter) filtered = matches.filter(m => m.winner === filter);

  const winners = [...new Set(matches.flatMap(m => [m.teamA, m.teamB]))];
  document.getElementById('reportFilter').innerHTML = `<option value="">All</option>` + winners.map(w => `<option value="${w}">${w}</option>`).join('');

  if(filtered.length === 0){
    reportContent.innerHTML = '<p>No data to show.</p>';
    return;
  }

  let html = '';
  filtered.forEach(m => {
    let totalPL = m.bets.reduce((acc,b) => {
      if(!m.winner) return acc;
      let p = 0;
      if(b.type === 'back') p = b.team === m.winner ? (b.stake*(b.odds-1)) : -b.stake;
      else if(b.type === 'lay') p = b.team === m.winner ? -((b.odds-1)*b.stake) : b.stake;
      return acc + p;
    },0);
    html += `<div class="p-3 mb-2 border rounded-xl">
      <p class="font-semibold">${m.name} | ${m.date}</p>
      <p>Winner: ${m.winner || 'N/A'}</p>
      <p>Total P/L: ${totalPL.toFixed(2)}</p>
    </div>`;
  });
  reportContent.innerHTML = html;
}
</script>

</body>
</html>